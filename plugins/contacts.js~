$(function() {
	$(document).on('click','.updateQuery', function(){
		var $this = $(this);
		var table = $this.data('table');
		var id = $this.data('id');
		var status = $this.data('status');
		var action = $this.data('action');
		bootbox.confirm('Are you sure you want to '+(status ? "activate" : "deactivate")+' this?', function(result) {
			if(result){
				$.ajax({
					url: path+'admin/contact/change-status',
					data : $this.closest('form').serialize()+'&id='+id+'&table='+table+'&status='+status+'&action='+action,
					dataType: 'json',
					type: 'post',
					beforeSend: function(){
						$this.html('<i class="fa fa-spin fa-spinner"></i>');
					},
					complete: function(){
						
					},
					success: function(json){
						console.log(json);
						if (json.success) {
							if(status){
								//alert(status);
								$this.data('status',0);
								new PNotify({
								   type: 'success',
								   title: 'Success',
								   text: 'Thanks for reply this query!'
								   });
								
								setTimeout(function() {
					                window.location = json.redirect_url;
					            }, 3000);
							}
							else{
								$this.data('status',1);
								$this.html('<i class="fa fa-circle inactive"></i>');
								new PNotify({
								   type: 'success',
								   title: 'Success',
								   text: 'Status changed'
								   });
							}
						} else if (json.exception_message) {
							if(status){
								$this.html('<i class="fa fa-circle inactive"></i>');
							}
							else{
								$this.html('<i class="fa fa-circle active"></i>');
							}
							new PNotify({
								   type: 'error',
								   title: 'Error',
								   text: 'Sorry, Something went wrong!!'
								   });
						}
					},
					error : function(xhr, ajaxOptions, thrownError) {
						
					}
				});
			}
		});
	});
});